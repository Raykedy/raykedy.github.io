<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Скачать книгу за криптодонат</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root {
      --bg:#0b0f14;
      --panel:#121824;
      --text:#e6f0ff;
      --muted:#a9b7d1;
      --stroke:#1c2533;
      --accent:#ffa600;
    }
    html,body{height:100%;}
    body {
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      overflow:hidden;
    }
    .video{
      position:fixed;inset:0;z-index:-2;
      object-fit:cover;width:100%;height:100%;
      filter:brightness(.38) saturate(1.05);
    }
    .overlay{
      position:fixed;inset:0;z-index:-1;
      background:radial-gradient(1200px 600px at 50% 20%, rgba(255,106,0,.18), transparent 60%);
    }
    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:24px;
    }
    .card{
      width:min(680px,92vw);
      background:color-mix(in srgb, var(--panel) 92%, transparent);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:28px 24px;
      box-shadow:0 20px 60px rgba(0,0,0,.45);
      backdrop-filter:blur(6px);
      text-align:center;
    }
    h1{margin:0 0 1rem;font-size:1.6rem;}
    p{margin:0.5rem 0;color:var(--muted);}
    .pill-btn{
      display:block;
      margin:12px auto;
      padding:14px 20px;
      border-radius:14px;
      border:1px solid var(--stroke);
      font-size:16px;
      cursor:pointer;
      font-weight:600;
    }
    .pill-primary{background:var(--accent);color:#000;}
    .pill-price{background:#00c46f;color:#000;}
    .email-input{
      width:100%;max-width:420px;
      margin:14px auto;
      padding:12px 16px;
      border-radius:12px;
      border:1px solid var(--stroke);
      font-size:15px;
      text-align:center;
    }
    footer{margin-top:30px;font-size:13px;color:var(--muted);}
    .link-back{color:#82c7f6;text-decoration:none;}
  </style>
</head>
<body>
  <!-- Фон -->
  <video class="video" autoplay muted playsinline loop poster="обложка.jpg">
    <source src="vdhub555.mp4" type="video/mp4">
  </video>
  <div class="overlay"></div>

  <main class="wrap">
    <section class="card">
      <div class="logo small">Ray Kedy • 2051</div>
      <h1>Скачать книгу за криптодонат</h1>
      <p>«2051: Алгоритм Пробуждение» — Ray Kedy</p>

      <button class="pill-btn pill-primary" id="btn-download">Скачать книгу за донат</button>
      <button class="pill-btn pill-price" id="btn-price">3.99 USDT</button>

      <input id="buyer-email" class="email-input" type="email"
             placeholder="Введите ваш e-mail, на который придёт книга"
             autocomplete="off" inputmode="email">

      <div style="margin-top:20px;">
        <button class="pill-btn" data-format="EPUB" aria-pressed="true">EPUB</button>
      </div>

      <footer>
        © 2051: Алгоритм Пробуждение — Ray Kedy<br>
        <a class="link-back" href="./index.html">← На главную</a>
      </footer>
    </section>
  </main>

  <script>
    function getEmail(){
      const v=document.getElementById('buyer-email').value.trim();
      if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(v)){
        alert("Введите корректный e-mail");
        return null;
      }
      return v;
    }
    function getFormat(){
      return "epub";
    }
    async function startInvoice(){
      const email=getEmail(); if(!email) return;
      const btn=document.getElementById("btn-download");
      const prev=btn.textContent;
      btn.disabled=true; btn.textContent="Генерация ссылки...";

      try{
        const res=await fetch("/api/create-invoice",{
          method:"POST",
          headers:{"content-type":"application/json"},
          body:JSON.stringify({
            amount:3.99,
            currency:"USDT",
            network:"TRC20",
            email,
            format:getFormat()
          })
        });
        const data=await res.json();
        if(data && data.url){
          window.open(data.url,"_blank");
        }else{
          alert("Не удалось создать ссылку. Проверь подключение.");
        }
      }catch(e){
        alert("Ошибка соединения. Попробуй ещё раз.");
      }finally{
        btn.disabled=false;
        btn.textContent=prev;
      }
    }
    document.getElementById("btn-download").addEventListener("click",startInvoice);
    document.getElementById("btn-price").addEventListener("click",startInvoice);
  </script>
</body>
</html>
