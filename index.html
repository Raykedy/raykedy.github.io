<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>2051: Алгоритм Пробуждение</title>
<style>
  html, body { height: 100%; margin: 0; background: #000; overflow: hidden; font-family: Arial, sans-serif; }
  #bgVideo { position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; pointer-events: none; background: #000; }
  .content { position: relative; z-index: 1; color: #fff; text-align: center; top: 40%; padding: 0 16px; }
  h1 { margin: 0 0 12px; font-size: 3rem; }
  p  { margin: 0 auto; max-width: 680px; font-size: 1.2rem; opacity: .9; }

  /* Верхний баннер (две строки, адаптивный) */
  .fixed-line-top{
    position: fixed;
    top: calc(8px + env(safe-area-inset-top));
    left: 50%;
    transform: translateX(-50%);
    z-index: 2;
    color: #ffcc66;
    background: rgba(0,0,0,0.45);
    padding: 8px 16px;
    border-radius: 8px;
    text-align: center;
    max-width: calc(100% - 24px);
    font-size: 1.05rem;
    line-height: 1.3;
    box-shadow: 0 2px 10px rgba(0,0,0,.35);
  }
  .fixed-line-top div { white-space: normal; }

  /* Подсказки (для ошибок/заметок) */
  .hint{
    position: fixed; left: 50%; bottom: calc(60px + env(safe-area-inset-bottom)); transform: translateX(-50%);
    color: #bbb; font-size: .95rem; text-align: center; z-index: 3;
    padding: 8px 14px; background: rgba(0,0,0,.4); border-radius: 8px;
    pointer-events: none; opacity: 0; transition: opacity .35s ease;
  }
  .hint.show{ opacity: 1; }

  /* Оверлей старта — показываем только в Firefox */
  .start-overlay{
    position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 3;
    background: rgba(0,0,0,.35);
  }
  .start-btn{
    background:#ff6600; color:#000; font-weight:700; border:0; border-radius:12px; padding:14px 20px; font-size:1.05rem;
    box-shadow:0 6px 18px rgba(0,0,0,.35); cursor:pointer;
  }

  @media (max-width: 600px){ h1{font-size:2.2rem;} .content p{font-size:1rem;} .fixed-line-top{font-size:.95rem;padding:6px 10px;} }
  @media (max-width: 380px){ h1{font-size:1.9rem;} .fixed-line-top{font-size:.9rem;padding:6px 8px;} }
</style>
</head>
<body>

<!-- ФОНОВОЕ ВИДЕО -->
<video id="bgVideo" autoplay muted loop playsinline preload="auto">
  <source src="https://raykedy.github.io/vidhub555.mp4?v=3" type="video/mp4">
</video>

<!-- МУЗЫКА -->
<audio id="bgMusic" preload="auto" loop>
  <source src="https://raw.githubusercontent.com/Raykedy/raykedy.github.io/main/motivational-adventure-cinematic-150072(2).mp3?v=3" type="audio/mpeg">
</audio>

<!-- Верхний баннер -->
<div class="fixed-line-top">
  <div>Официальный хаб раздачи.</div>
  <div>Скачать книгу можно здесь.</div>
</div>

<!-- Центральный текст -->
<div class="content">
  <h1>2051: Алгоритм Пробуждение</h1>
  <p>Погрузись в мир, где границы между разумом и кодом стираются.</p>
</div>

<!-- Подсказка и Firefox-оверлей -->
<div id="hint" class="hint"></div>
<div id="startOverlay" class="start-overlay"><button id="startBtn" class="start-btn">Запустить</button></div>

<script>
(function () {
  const video   = document.getElementById('bgVideo');
  const audio   = document.getElementById('bgMusic');
  const hint    = document.getElementById('hint');
  const overlay = document.getElementById('startOverlay');
  const startBtn= document.getElementById('startBtn');

  // Определяем Firefox
  const isFirefox = /firefox/i.test(navigator.userAgent);

  // Стартуем аудио без звука (для обхода автоплея вне Firefox)
  audio.volume = 0;

  const showHint = (msg) => {
    hint.textContent = msg;
    hint.classList.add('show');
    clearTimeout(showHint._t);
    showHint._t = setTimeout(() => hint.classList.remove('show'), 4000);
  };

  const fadeInAudio = (target=1, step=0.02, ms=100) => {
    let v = audio.volume;
    const id = setInterval(() => {
      v = Math.min(target, v + step);
      audio.volume = v;
      if (v >= target) clearInterval(id);
    }, ms);
  };

  // Подгоняем аудио под видео только когда видео ИДЁТ
  function alignAudioToVideo() {
    if (video.paused || video.seeking || video.readyState < 2) return;
    if (!isFinite(audio.duration) || audio.duration <= 0) return;
    const target = video.currentTime % audio.duration;
    const cur    = audio.currentTime % audio.duration;
    if (Math.abs(cur - target) > 0.35) audio.currentTime = target;
  }

  let driftTimer = null;
  function startDrift(){ if (!driftTimer) driftTimer = setInterval(alignAudioToVideo, 2000); }
  function stopDrift(){ if (driftTimer){ clearInterval(driftTimer); driftTimer = null; } }

  // Старт логика:
  // - В НЕ-Firefox пытаемся автозапустить.
  // - В Firefox сразу показываем кнопку.
  function initStartLogic() {
    if (isFirefox) {
      overlay.style.display = 'flex'; // ждем явный клик
      return;
    }
    // Не Firefox → пробуем автозапуск
    video.play().then(() => {
      // Видео пошло → запускаем аудио
      alignAudioToVideo();
      audio.play().then(() => { fadeInAudio(1,0.02,100); startDrift(); })
                  .catch(() => { showHint('Нажми где угодно, чтобы включить звук'); });
    }).catch(() => {
      // Даже не в Firefox не дали автоплей (редко) — просим клик
      overlay.style.display = 'flex';
    });
  }

  // Пользовательский запуск (для Firefox и фолбэков)
  function userStart() {
    video.play().catch(()=>{});
    audio.play().then(() => {
      alignAudioToVideo();
      fadeInAudio(1, 0.02, 100);
      startDrift();
    }).catch(()=>{});
    overlay.style.display = 'none';
    hint.classList.remove('show');
    window.removeEventListener('pointerdown', userStart, { passive:true });
  }

  // События
  video.addEventListener('loadedmetadata', initStartLogic);
  video.addEventListener('play', () => { // если кто-то запустил видео вручную
    if (audio.paused) { audio.play().then(()=>{ fadeInAudio(1,0.02,100); startDrift(); }).catch(()=>{}); }
  });
  video.addEventListener('pause', () => { audio.pause(); stopDrift(); });
  video.addEventListener('seeking', alignAudioToVideo);
  video.addEventListener('seeked',  alignAudioToVideo);
  video.addEventListener('timeupdate', alignAudioToVideo);

  startBtn.addEventListener('click', userStart);
  // На всякий случай — клик по странице тоже стартует (помогает на некоторых сборках)
  window.addEventListener('pointerdown', userStart, { passive:true });

  video.addEventListener('error', () => showHint('Ошибка видео: проверь ссылку или имя файла'));
  audio.addEventListener('error', () => showHint('Ошибка аудио: проверь ссылку на mp3'));
})();
</script>

</body>
</html>
